<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title th:text="${item.title}">Item Detail</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body>
  <a href="/items">← 一覧へ</a>

  <h1 th:text="${item.title}">title</h1>
  <p th:text="${item.description}">description</p>
  <p><span th:text="${item.price}">0</span>円</p>
  <p>状態: <span th:text="${item.condition}">condition</span></p>

  <div id="flash" style="margin:8px 0;"></div>

  <div>
    <button id="btn-bookmark" type="button" th:attr="data-item-id=${item.id}">
      ブックマークする
    </button>

    <button id="btn-unbookmark" type="button" th:attr="data-item-id=${item.id}">
      ブックマーク解除
    </button>
  </div>

  <script>
    const flash = (msg) => {
      const el = document.getElementById('flash');
      el.textContent = msg;
      setTimeout(() => el.textContent = '', 2000);
    };

    async function callBookmark(itemId, method) {
      const res = await fetch(`/api/bookmarks/${itemId}`, {
        method,
        headers: { 'Accept': 'application/json' },
        credentials: 'same-origin'
      });

      if (!res.ok) {
        flash(method === 'POST' ? '登録に失敗しました' : '解除に失敗しました');
        return;
      }

      const data = await res.json().catch(() => null);
      flash(data?.message ?? (method === 'POST' ? 'bookmarked' : 'unbookmarked'));
    }

    document.getElementById('btn-bookmark')?.addEventListener('click', (e) => {
      callBookmark(e.target.dataset.itemId, 'POST');
    });

    document.getElementById('btn-unbookmark')?.addEventListener('click', (e) => {
      callBookmark(e.target.dataset.itemId, 'DELETE');
    });
  </script>
</body>
</html>
